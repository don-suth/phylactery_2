{% extends "_base.html" %}

{% block content %}
	<h2 class="text-center">Library Dashboard</h2>

	<ul class="nav nav-tabs mb-3 justify-content-center fs-5" id="pills-tab" role="tablist">
		<li class="nav-item" role="presentation">
			<button class="nav-link" id="pills-borrow-tab" data-bs-toggle="pill" data-bs-target="#pills-borrow"
					type="button" role="tab" aria-controls="pills-borrow" aria-selected="true">
				Borrow
			</button>
		</li>
		<li class="nav-item" role="presentation">
			<button class="nav-link active" id="pills-overview-tab" data-bs-toggle="pill" data-bs-target="#pills-overview"
					type="button" role="tab" aria-controls="pills-overview" aria-selected="false">
				Overview
			</button>
		</li>
		<li class="nav-item" role="presentation">
			<button class="nav-link" id="pills-return-tab" data-bs-toggle="pill" data-bs-target="#pills-return"
					type="button" role="tab" aria-controls="pills-return" aria-selected="false">
				Return
			</button>
		</li>
	</ul>
	<div class="tab-content" id="pills-tabContent">
		<div class="tab-pane fade" id="pills-borrow" role="tabpanel" aria-labelledby="pills-borrow-tab" tabindex="0">
			{% comment %}
				1. If there are any active reservations for today, prominently display them / link to them.
				2. Then just link to the borrow form.
			{% endcomment %}
			<div class="row">
				<div class="col">
					{% if reservations_today %}
						<div class="card text-center border-danger">
							<div class="card-header">
								Active Reservations!
							</div>
							<div class="card-body">
								<h5 class="card-title">There are active reservations today!</h5>
								<p class="card-text">
									If someone is wishing to check out a reservation for today, select it on the list below.
								</p>
							</div>
							<table class="table table-hover">
								<thead>
									<tr>
										<th scope="col">Requestor Name</th>
										<th scope="col"># of Items</th>
										<th scope="col"><i class="bi-link-45deg" style="font-size: 1.25rem;"></i></th>
									</tr>
								</thead>
								<tbody>
									{% for reservation in reservations_today %}
									<tr>
										<td>{{ reservation.requestor_name }}</td>
										<td>{{ reservation.reserved_items.count }}</td>
										<td>
											<a href="#" class="clickable-cell">Link</a>
										</td>
									</tr>
								{% endfor %}
								</tbody>
							</table>
							<div class="card-body">
								<p class="card-text">
									Otherwise, proceed as normal to the borrowing form.
								</p>
								<a href="{% url 'library:borrow-wizard' %}" class="btn btn-primary">Borrowing Form</a>
							</div>
						</div>
					{% else %}
						<div class="card text-center">
							<div class="card-body">
								<p class="card-text">
									Click below to go to the borrowing form.
								</p>
								<a href="{% url 'library:borrow-wizard' %}" class="btn btn-primary">Borrowing Form</a>
							</div>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
		<div class="tab-pane fade show active" id="pills-overview" role="tabpanel" aria-labelledby="pills-overview-tab" tabindex="0">
			{% comment %}
				1. If they are committee, show librarian specific stuff
					- Unapproved reservations
					- Returns to verify
				2. For gatekeepers, show:
					- List of all items currently borrowed out, for easy checking.
					- Upcoming active reservations
			{% endcomment %}
			{% if user.member.is_committee %}
				<div class="row bg-info-subtle pt-2 mb-2">
					<div class="col-md mb-2">
						<div class="card h-100 text-center">
							<div class="card-body">
								<h5 class="card-title">Unapproved Reservations</h5>
								<p class="card-text">
									There are currently {{ unapproved_reservations.count|default:"0" }} unapproved reservations.
								</p>
							</div>
							<table class="table table-hover">
								<thead>
									<tr>
										<th scope="col">Name</th>
										<th scope="col"><i class="bi-calendar-check"></i> Borrow</th>
										<th scope="col"><i class="bi-link-45deg" style="font-size: 1.25rem;"></i></th>
									</tr>
								</thead>
								<tbody>
									{% for reservation in unapproved_reservations %}
									<tr>
										<td>{{ reservation.requestor_name }}</td>
										<td>{{ reservation.requested_date_to_borrow }}</td>
										<td>
											<a href="{% url 'library:approve-reservation' pk=reservation.pk %}" class="clickable-cell">Link</a>
										</td>
									</tr>
								{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
					<div class="col-md mb-2">
						<div class="card h-100 text-center">
							<div class="card-body">
								<h5 class="card-title">Committee Specific stuff</h5>
								<p class="card-text">
									There are {{ to_be_verified.count|default:"0" }} items to be verified as returned.
								</p>
								<a href="#" class="btn btn-success">Verify Returned Items</a>
							</div>
						</div>
					</div>
				</div>
			{% endif %}
			<div class="row row-cols-1 row-cols-md-2">
				<div class="col mb-2">
					<div class="card">
						<div class="card-body">
							<h5 class="card-title">All borrowed items</h5>
							<p class="card-text">
								All items borrowed out
							</p>
						</div>
					</div>
				</div>
				<div class="col mb-2">
					<div class="card">
						<div class="card-body">
							<h5 class="card-title">Upcoming reservations</h5>
							<p class="card-text">
								Upcoming reservations will go here
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="tab-pane fade" id="pills-return" role="tabpanel" aria-labelledby="pills-return-tab" tabindex="0">
			{% comment %}
				1. Show a list of borrower details, with a link to return items for them.
			{% endcomment %}
			<div class="row">
				<div class="col">
					<div class="card">
						<div class="card-body">
							<p class="card-text">
								{% for borrower in outstanding_borrowers %}
									{{ borrower }}
								{% endfor %}
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}